import{getContext as e,getElement as i,store as t}from"@wordpress/interactivity";let s=null;const{state:o,actions:r}=t("frs/profile-editor",{state:{get isDesktop(){return"desktop"===e().previewDevice},get isTablet(){return"tablet"===e().previewDevice},get isMobile(){return"mobile"===e().previewDevice},get previewWidth(){switch(e().previewDevice){case"tablet":return"768px";case"mobile":return"375px";default:return"100%"}}},actions:{toggleEdit(){const i=e();i.isEditing||(s=JSON.parse(JSON.stringify(i.profile))),i.isEditing=!i.isEditing,document.body.classList.toggle("frs-edit-mode",i.isEditing),window.dispatchEvent(new CustomEvent("frs:editModeChanged",{detail:{isEditing:i.isEditing}}))},cancelEdit(){const i=e();s&&(i.profile=JSON.parse(JSON.stringify(s))),i.isEditing=!1,document.body.classList.remove("frs-edit-mode"),window.dispatchEvent(new CustomEvent("frs:editModeChanged",{detail:{isEditing:!1}}))},flip(){const i=e();i.isFlipped=!i.isFlipped},setDesktop(){e().previewDevice="desktop",r.applyPreview()},setTablet(){e().previewDevice="tablet",r.applyPreview()},setMobile(){e().previewDevice="mobile",r.applyPreview()},applyPreview(){const i=e(),t=document.querySelector(".frs-profile__preview-content");if(t)switch(t.style.transition="max-width 0.3s ease",i.previewDevice){case"tablet":t.style.maxWidth="768px",t.style.margin="0 auto";break;case"mobile":t.style.maxWidth="375px",t.style.margin="0 auto";break;default:t.style.maxWidth="",t.style.margin=""}},updateField(i){const t=e(),s=i.target,o=s.dataset.field;o&&t.profile&&(t.profile[o]=s.value)},toggleServiceArea(i){const t=e(),s=i.target,o=s.value;t.profile.service_areas||(t.profile.service_areas=[]);const r=t.profile.service_areas.indexOf(o);s.checked&&-1===r?t.profile.service_areas=[...t.profile.service_areas,o]:!s.checked&&r>-1&&(t.profile.service_areas=t.profile.service_areas.filter(e=>e!==o))},toggleSpecialty(i){const t=e(),s=i.target,o=s.value;t.profile.specialties_lo||(t.profile.specialties_lo=[]);const r=t.profile.specialties_lo.indexOf(o);s.checked&&-1===r?t.profile.specialties_lo=[...t.profile.specialties_lo,o]:!s.checked&&r>-1&&(t.profile.specialties_lo=t.profile.specialties_lo.filter(e=>e!==o))},toggleCertification(i){const t=e(),s=i.target,o=s.value;t.profile.namb_certifications||(t.profile.namb_certifications=[]);const r=t.profile.namb_certifications.indexOf(o);s.checked&&-1===r?t.profile.namb_certifications=[...t.profile.namb_certifications,o]:!s.checked&&r>-1&&(t.profile.namb_certifications=t.profile.namb_certifications.filter(e=>e!==o))},updateLinkTitle(i){const t=e(),s=i.target,o=parseInt(s.dataset.index,10);if(t.profile.custom_links||(t.profile.custom_links=[]),t.profile.custom_links[o]){const e=[...t.profile.custom_links];e[o]={...e[o],title:s.value},t.profile.custom_links=e}},updateLinkUrl(i){const t=e(),s=i.target,o=parseInt(s.dataset.index,10);if(t.profile.custom_links||(t.profile.custom_links=[]),t.profile.custom_links[o]){const e=[...t.profile.custom_links];e[o]={...e[o],url:s.value},t.profile.custom_links=e}},addLink(){const i=e();i.profile.custom_links||(i.profile.custom_links=[]),i.profile.custom_links=[...i.profile.custom_links,{title:"",url:""}];const t=document.querySelector(".frs-profile__links-edit-list");if(t){const e=i.profile.custom_links.length-1,s=document.createElement("div");s.className="frs-profile__link-edit-item",s.dataset.index=e,s.innerHTML=`\n                    <input\n                        type="text"\n                        class="frs-profile__edit-input"\n                        data-wp-on--input="actions.updateLinkTitle"\n                        data-index="${e}"\n                        placeholder="Link Title"\n                    >\n                    <input\n                        type="url"\n                        class="frs-profile__edit-input"\n                        data-wp-on--input="actions.updateLinkUrl"\n                        data-index="${e}"\n                        placeholder="https://example.com"\n                    >\n                    <button\n                        type="button"\n                        class="frs-profile__link-remove-btn"\n                        data-wp-on--click="actions.removeLink"\n                        data-index="${e}"\n                        title="Remove link"\n                    >\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                            <line x1="18" y1="6" x2="6" y2="18"></line>\n                            <line x1="6" y1="6" x2="18" y2="18"></line>\n                        </svg>\n                    </button>\n                `,t.appendChild(s);const o=s.querySelector('input[data-wp-on--input="actions.updateLinkTitle"]'),n=s.querySelector('input[data-wp-on--input="actions.updateLinkUrl"]'),l=s.querySelector('button[data-wp-on--click="actions.removeLink"]');o&&o.addEventListener("input",r.updateLinkTitle),n&&n.addEventListener("input",r.updateLinkUrl),l&&l.addEventListener("click",r.removeLink)}},removeLink(i){const t=e(),s=i.target.closest("button")||i.target,o=parseInt(s.dataset.index,10);if(!t.profile.custom_links)return;t.profile.custom_links=t.profile.custom_links.filter((e,i)=>i!==o);const r=s.closest(".frs-profile__link-edit-item");r&&r.remove();const n=document.querySelector(".frs-profile__links-edit-list");n&&n.querySelectorAll(".frs-profile__link-edit-item").forEach((e,i)=>{e.dataset.index=i,e.querySelectorAll("[data-index]").forEach(e=>{e.dataset.index=i})})},async saveProfile(){const i=e();i.isSaving=!0;const t={job_title:i.profile.job_title,city_state:i.profile.city_state,email:i.profile.email,phone_number:i.profile.phone_number,biography:i.profile.biography,website:i.profile.website,facebook_url:i.profile.facebook_url,instagram_url:i.profile.instagram_url,linkedin_url:i.profile.linkedin_url,twitter_url:i.profile.twitter_url,specialties_lo:i.profile.specialties_lo||[],namb_certifications:i.profile.namb_certifications||[],service_areas:i.profile.service_areas||[],custom_links:i.profile.custom_links||[]};try{const e=await fetch("/wp-json/frs-users/v1/profiles/user/me",{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":window.frsProfileEditor?.nonce||""},body:JSON.stringify(t)});if(!e.ok){const i=await e.json();throw new Error(i.message||"Failed to save profile")}s=JSON.parse(JSON.stringify(i.profile)),i.isEditing=!1,document.body.classList.remove("frs-edit-mode"),window.dispatchEvent(new CustomEvent("frs:profileSaved",{detail:{success:!0}}))}catch(e){console.error("Save failed:",e),window.dispatchEvent(new CustomEvent("frs:profileSaved",{detail:{success:!1,error:e.message}})),alert("Failed to save profile: "+e.message)}finally{i.isSaving=!1}}},callbacks:{initField(){const{ref:e}=i();e&&e.dataset.field&&(e.dataset.frsOriginal=e.value||"")}}});